<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Malayalam Transliteration Form</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

<div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-2xl">
  <h2 class="text-2xl font-bold mb-4 text-gray-800">Fill the Details (Type in Manglish)</h2>
  
  <form id="form" class="space-y-4">
    <!-- The fields will be inserted dynamically -->
  </form>

  <div class="mt-6 flex justify-between">
    <button type="button" onclick="copyOutput()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Copy</button>
    <button type="button" onclick="resetForm()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Reset</button>
    <button type="button" onclick="downloadOutput()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">Download</button>
  </div>

  <h3 class="mt-6 font-semibold text-lg">Malayalam Output:</h3>
  <textarea id="output" readonly class="w-full h-32 mt-2 border rounded-lg p-2 bg-gray-50"></textarea>
</div>

<script>
const blanks = [
  "Name",
  "Survey Number",
  "Aar",
  "Sq. Meter",
  "Varsham Prayam",
  "Coconut No",
  "North",
  "South",
  "East",
  "West"
];

const form = document.getElementById("form");
let timeout;

blanks.forEach((label, i) => {
  const div = document.createElement("div");
  div.innerHTML = `
    <label class="block text-gray-700 font-medium mb-1">${label}</label>
    <textarea id="blank${i+1}" rows="1" placeholder="Type in Manglish..." 
      class="w-full border rounded-lg p-2 focus:ring focus:ring-blue-200 resize-none"></textarea>
  `;
  form.appendChild(div);
  
  const field = div.querySelector("textarea");
  field.addEventListener("input", () => {
    clearTimeout(timeout);
    timeout = setTimeout(() => transliterateLastWord(field), 1000);
  });
});

async function transliterateLastWord(field) {
  const words = field.value.split(/\s+/);
  const lastWord = words[words.length - 1];
  if (!lastWord || /^\d+$/.test(lastWord)) return; // skip if empty or number

  const url = `https://inputtools.google.com/request?text=${encodeURIComponent(lastWord)}&itc=ml-t-i0-und&num=1&cp=0&cs=1&ie=utf-8&oe=utf-8`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    if (data[0] === "SUCCESS" && data[1]?.[0]?.[1]?.[0]) {
      words[words.length - 1] = data[1][0][1][0];
      field.value = words.join(" ");
      updateOutput();
    }
  } catch (err) {
    console.error("Transliteration error:", err);
  }
}

function updateOutput() {
  const allTexts = blanks.map((_, i) => {
    const val = document.getElementById(`blank${i+1}`).value.trim();
    return val ? `${blanks[i]}: ${val}` : "";
  }).filter(Boolean);
  document.getElementById("output").value = allTexts.join("\n");
}

function copyOutput() {
  const out = document.getElementById("output");
  out.select();
  document.execCommand("copy");
  alert("Copied to clipboard!");
}

function resetForm() {
  document.querySelectorAll("textarea").forEach(t => t.value = "");
  document.getElementById("output").value = "";
}

function downloadOutput() {
  const text = document.getElementById("output").value;
  const blob = new Blob([text], { type: "text/plain" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "Malayalam_Output.txt";
  link.click();
}
</script>

</body>
</html>